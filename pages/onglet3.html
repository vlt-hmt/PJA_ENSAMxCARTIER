<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Graphiques Circulaires par Pays</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <link rel="stylesheet" href="style.css"> <!-- Ton fichier CSS global -->
</head>
<body>
    <div class="header-image">
        <div class="header-overlay">ENSAM x Cartier</div>
    </div>
    <header class="menu">
        <div id="menu-container"></div>
        <script>
            fetch('../menu.html')
                .then(response => response.text())
                .then(data => {
                    document.getElementById('menu-container').innerHTML = data;
                })
                .catch(error => console.error('Erreur lors du chargement du menu :', error));
        </script>
    </header>
    <main class="content">
        <h1>Données Matériaux Campagne EOY2024</h1>
        <p>D'après les données de la campagne EOY 2024, l'histogramme ci-dessous représente l'impact Carbone théorique calculé par la maison Cartier à l'aide de coefficients en kgCO2eq/kg matière.</p>
        <p>Sous cet histogramme, il est possible de sélectionner un pays et d'avoir plus d'informations localement par pays.</p>
        
        <div class="chart-container">
            <div id="chart" class="chart"></div>
            <div id="volume-chart" class="chart"></div>
            <div id="carbon-chart" class="chart"></div>
        </div>
        <label for="country-select">Sélectionnez un pays :</label>
        <select id="country-select" onchange="updateChart()">
            <!-- Les options de pays seront ajoutées par JavaScript -->
        </select>
        
        <table id="summary-table">
            <thead>
                <tr>
                    <th>Matériau</th>
                    <th>Quantité (kg)</th>
                    <th>Impact Carbone (kgCO2)</th>
                    <th>Volume (m³)</th>
                </tr>
            </thead>
            <tbody>
                <!-- Les données seront ajoutées par JavaScript -->
            </tbody>
            <tfoot>
                <tr>
                    <th>Total</th>
                    <th id="total-quantity">0</th>
                    <th id="total-carbon-impact">0</th>
                    <th id="total-volume">0</th>
                </tr>
            </tfoot>
        </table>
    </main>
    <script>
        let data = {}; // Les données seront chargées dynamiquement

        document.addEventListener("DOMContentLoaded", function() {
            fetch("https://<your-github-username>.github.io/<repository-name>/data.json")
                .then(response => response.json())
                .then(jsonData => {
                    data = jsonData;
                    const countrySelect = document.getElementById("country-select");
                    Object.keys(data).forEach(country => {
                        const option = document.createElement("option");
                        option.value = country;
                        option.textContent = country;
                        countrySelect.appendChild(option);
                    });
                    updateChart(); // Met à jour le graphique avec les données chargées
                })
                .catch(error => {
                    console.error("Erreur lors du chargement des données JSON :", error);
                });
        });

        function updateChart() {
            const country = document.getElementById("country-select").value || "Germany";
            const values = data[country];

            updatePieChart('chart', values, 'Répartition des Matériaux en ' + country + ' (Poids)', materials);
            updateTable(country, values);
        }

        function updatePieChart(chartId, values, title, labels) {
            const chartData = [{
                values: values,
                labels: labels,
                type: 'pie',
                textinfo: 'label+percent',
                hoverinfo: 'label+percent+name+value',
                marker: { colors: materialColors }
            }];

            const layout = {
                title: title
            };

            Plotly.newPlot(chartId, chartData, layout);
        }

        function updateTable(country, values) {
            const tableBody = document.querySelector("#summary-table tbody");
            tableBody.innerHTML = "";

            let totalQuantity = 0;
            let totalCarbonImpact = 0;
            let totalVolume = 0;

            materials.forEach((material, index) => {
                const quantity = values[index];
                const carbonImpactPerKg = carbonImpact[material.toUpperCase()] || 0;
                const carbonImpactTotal = quantity * carbonImpactPerKg;
                const density = densities[material.toUpperCase()] || 1;
                const volume = quantity / density;

                totalQuantity += quantity;
                totalCarbonImpact += carbonImpactTotal;
                totalVolume += volume;

                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${material}</td>
                    <td>${quantity.toFixed(2)}</td>
                    <td>${carbonImpactTotal.toFixed(2)}</td>
                    <td>${volume.toFixed(2)}</td>
                `;
                tableBody.appendChild(row);
            });

            document.getElementById("total-quantity").textContent = totalQuantity.toFixed(2);
            document.getElementById("total-carbon-impact").textContent = totalCarbonImpact.toFixed(2);
            document.getElementById("total-volume").textContent = totalVolume.toFixed(2);

            updatePieChart('carbon-chart', carbonImpacts, 'Répartition des Impacts Carbone par Matériaux', materials);
            updatePieChart('volume-chart', volumes, 'Répartition des Volumes par Matériaux', materials);
        }
    </script>
</body>
</html>
