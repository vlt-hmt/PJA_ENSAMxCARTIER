<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Onglet 4 - Sélection du Matériau</title>
    
    <!-- Polices et bibliothèques externes -->
    <link href="https://fonts.googleapis.com/css2?family=Libre+Bodoni:ital,wght@1,400&family=Playfair+Display:wght@400;700&family=Montserrat:wght@400;500&display=swap" rel="stylesheet">
    <!-- Inclure Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <!-- Votre fichier CSS -->
    <link rel="stylesheet" href="../styles.css">
</head>
<body>
    <!-- Image d'en-tête -->
    <div class="header-image">
        <div class="header-overlay">ENSAM x Cartier</div> <!-- Texte superposé -->
    </div>

    <!-- Menu de navigation -->
    <header class="menu">
        <nav>
            <ul>
                <li><a href="../index.html">Accueil</a></li>
                <li><a href="onglet1.html">Onglet 1</a></li>
                <li><a href="onglet2.html">Onglet 2</a></li>
                <li><a href="onglet3.html">Onglet 3</a></li>
                <li><a href="onglet4.html">Onglet 4</a></li>
                <li><a href="contact.html">Contact</a></li>
            </ul>
        </nav>
    </header>

    <!-- Contenu principal -->
    <main class="content">
        <h1>Analyse des impacts environnementaux par matériau</h1>
        <p>Sélectionnez un matériau pour voir les détails de son impact environnemental selon différentes méthodes de traitement de fin de vie.</p>

        <!-- Menu déroulant des matériaux -->
        <label for="materialDropdown">Choisissez un matériau :</label>
        <select id="materialDropdown">
            <option value="">Sélectionnez un matériau</option>
        </select>

        <!-- Division pour afficher les informations du matériau sélectionné -->
        <div id="materialInfo">
            <p>Sélectionnez un matériau pour voir les informations.</p>
        </div>

        <!-- Division pour le graphique Plotly -->
        <div id="plotlyChart"></div>

        <!-- Division pour afficher la recommandation -->
        <div id="recommendation"></div>
    </main>

    <!-- Pied de page -->
    <div class="footer">
        <p>&copy; 2024/2025 Baptiste Légier, Pierre-Vincent Arcade, Valentin Hyaumet. Tous droits réservés.</p>
    </div>

    <!-- Script pour charger le fichier JSON et gérer l'interaction -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // Charger les données JSON
        fetch('../static/json/impactfdvmat.json')
          .then(response => response.json())
          .then(data => {
            const materials = data['Feuil1'];
            const dropdown = document.getElementById('materialDropdown');
            let plotlyChartDiv = document.getElementById('plotlyChart'); // Division pour le graphique Plotly

            // Peupler le menu déroulant
            materials.forEach(material => {
                const option = document.createElement('option');
                option.value = material['Matériau'];
                option.text = material['Matériau'];
                dropdown.add(option);
            });

            // Écouter les changements du menu déroulant
            dropdown.addEventListener('change', function() {
                const selectedMaterial = this.value;
                const materialInfoDiv = document.getElementById('materialInfo');
                const recommendationDiv = document.getElementById('recommendation');

                if (selectedMaterial === "") {
                    materialInfoDiv.innerHTML = '<p>Sélectionnez un matériau pour voir les informations.</p>';
                    // Effacer le graphique Plotly
                    Plotly.purge('plotlyChart');
                    // Effacer la recommandation
                    recommendationDiv.innerHTML = '';
                    return;
                }

                // Trouver les données du matériau sélectionné
                const materialData = materials.find(item => item['Matériau'] === selectedMaterial);

                if (materialData) {
                    // Afficher les informations du matériau
                    materialInfoDiv.innerHTML = `
                        <h2>${materialData['Matériau']}</h2>
                        <!-- Vous pouvez ajouter plus d'informations ici si nécessaire -->
                    `;

                    // Préparer les données pour le graphique 3D
                    const methods = [];
                    const emissions = [];
                    const emissionsByMethod = {};

                    ['Incinération', 'Recyclage', 'Méthanisation'].forEach(method => {
                        const impactKey = `${method} - Impact (kg éq. CO2/tonne)`;
                        const avoidedEmissionsKey = `${method} - Émissions Évitées (kg éq. CO2/tonne)`;

                        let impactValue = parseFloat(materialData[impactKey]);
                        let avoidedEmissionsValue = parseFloat(materialData[avoidedEmissionsKey]);

                        // Gérer les valeurs "N/A" ou non numériques
                        if (isNaN(impactValue) && isNaN(avoidedEmissionsValue)) {
                            return;
                        }
                        if (isNaN(impactValue)) impactValue = 0;
                        if (isNaN(avoidedEmissionsValue)) avoidedEmissionsValue = 0;

                        const totalEmissions = impactValue + avoidedEmissionsValue;

                        methods.push(method);
                        emissions.push(totalEmissions);
                        emissionsByMethod[method] = totalEmissions;
                    });

                    // Afficher la recommandation
                    let recommendedMethod = null;
                    let minEmissions = null;

                    for (const method in emissionsByMethod) {
                        const emission = emissionsByMethod[method];
                        if (minEmissions === null || emission < minEmissions) {
                            minEmissions = emission;
                            recommendedMethod = method;
                        }
                    }

                    if (recommendedMethod) {
                        recommendationDiv.innerHTML = `
                            <p>Le processus de fin de vie le plus approprié pour <strong>${materialData['Matériau']}</strong> est : <strong>${recommendedMethod}</strong>.</p>
                        `;
                    } else {
                        recommendationDiv.innerHTML = '';
                    }

                    // Préparer les données pour le graphique 3D
                    const xValues = methods;
                    const yValues = methods.map(() => selectedMaterial); // Le matériau sélectionné répété
                    const zValues = emissions;

                    const trace = {
                        x: xValues,
                        y: yValues,
                        z: zValues,
                        type: 'scatter3d',
                        mode: 'markers',
                        marker: {
                            size: 5,
                            color: zValues,
                            colorscale: 'Viridis',
                            showscale: true
                        }
                    };

                    const layout = {
                        title: `Émissions 3D pour ${selectedMaterial}`,
                        scene: {
                            xaxis: { title: 'Méthode de traitement' },
                            yaxis: { title: 'Matériau' },
                            zaxis: { title: 'Émissions totales (kg éq. CO2/tonne)' }
                        }
                    };

                    // Effacer le graphique précédent
                    Plotly.purge('plotlyChart');

                    // Créer le graphique
                    Plotly.newPlot('plotlyChart', [trace], layout);

                } else {
                    materialInfoDiv.innerHTML = '<p>Aucune donnée disponible pour ce matériau.</p>';
                    // Effacer le graphique Plotly
                    Plotly.purge('plotlyChart');
                    recommendationDiv.innerHTML = '';
                }
            });

          })
          .catch(error => console.error('Erreur lors du chargement du fichier JSON :', error));
    });
    </script>

</body>
</html>
