<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Onglet 4 - Sélection du Matériau</title>
    
    <!-- Polices et bibliothèques externes -->
    <link href="https://fonts.googleapis.com/css2?family=Libre+Bodoni:ital,wght@1,400&family=Playfair+Display:wght@400;700&family=Montserrat:wght@400;500&display=swap" rel="stylesheet">
    <!-- Inclure Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Script générique -->
    <script src="../script.js" defer></script>
    <link rel="stylesheet" href="../styles.css">
</head>
<body>
    <!-- Image d'en-tête -->
    <div class="header-image">
        <div class="header-overlay">ENSAM x Cartier</div> <!-- Texte superposé -->
    </div>

    <!-- Menu de navigation -->
    <header class="menu">
        <nav>
            <ul>
                <li><a href="../index.html">Accueil</a></li>
                <li><a href="onglet1.html">Onglet 1</a></li>
                <li><a href="onglet2.html">Onglet 2</a></li>
                <li><a href="onglet3.html">Onglet 3</a></li>
                <li><a href="onglet4.html">Onglet 4</a></li>
                <li><a href="contact.html">Contact</a></li>
            </ul>
        </nav>
    </header>

    <!-- Contenu principal -->
    <main class="content">
        <h1>Analyse des impacts environnementaux par matériau</h1>
        <p>Sélectionnez un matériau pour voir les détails de son impact environnemental selon différentes méthodes de traitement de fin de vie.</p>

        <!-- Menu déroulant des matériaux -->
        <label for="materialDropdown">Choisissez un matériau :</label>
        <select id="materialDropdown">
            <option value="">Sélectionnez un matériau</option>
        </select>

        <!-- Division pour afficher les informations du matériau sélectionné -->
        <div id="materialInfo">
            <p>Sélectionnez un matériau pour voir les informations.</p>
        </div>

        <!-- Élément canvas pour le graphique -->
        <canvas id="emissionsChart" width="180" height="90"></canvas>
    </main>

    <!-- Pied de page -->
    <div class="footer">
        <p>&copy; 2024/2025 Baptiste Légier, Pierre-Vincent Arcade, Valentin Hyaumet. Tous droits réservés.</p>
    </div>

    <!-- Script pour charger le fichier JSON et gérer l'interaction -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // Charger les données JSON
        fetch('../static/json/impactfdvmat.json')
          .then(response => response.json())
          .then(data => {
            const materials = data['Feuil1'];
            const dropdown = document.getElementById('materialDropdown');
            let emissionsChart; // Variable pour stocker le graphique

            // Peupler le menu déroulant
            materials.forEach(material => {
              const option = document.createElement('option');
              option.value = material['Matériau'];
              option.text = material['Matériau'];
              dropdown.add(option);
            });

            // Écouter les changements du menu déroulant
            dropdown.addEventListener('change', function() {
              const selectedMaterial = this.value;
              const materialInfoDiv = document.getElementById('materialInfo');
              const chartCanvas = document.getElementById('emissionsChart');

              if (selectedMaterial === "") {
                materialInfoDiv.innerHTML = '<p>Sélectionnez un matériau pour voir les informations.</p>';
                // Supprimer le graphique s'il existe
                if (emissionsChart) {
                  emissionsChart.destroy();
                }
                return;
              }

              // Trouver les données du matériau sélectionné
              const materialData = materials.find(item => item['Matériau'] === selectedMaterial);

              if (materialData) {
                // Construire le HTML pour afficher les informations du matériau
                materialInfoDiv.innerHTML = `
                  <h2>${materialData['Matériau']}</h2>
                  <!-- Afficher les informations si nécessaire -->
                `;

                // Préparer les données pour le graphique
                const methods = [];
                const emissions = [];

                ['Incinération', 'Recyclage', 'Méthanisation'].forEach(method => {
                  const impactKey = `${method} - Impact (kg éq. CO2/tonne)`;
                  const avoidedEmissionsKey = `${method} - Émissions Évitées (kg éq. CO2/tonne)`;

                  let impactValue = parseFloat(materialData[impactKey]);
                  let avoidedEmissionsValue = parseFloat(materialData[avoidedEmissionsKey]);

                  // Gérer les valeurs "N/A" ou non numériques
                  if (isNaN(impactValue) && isNaN(avoidedEmissionsValue)) {
                    return;
                  }
                  if (isNaN(impactValue)) impactValue = 0;
                  if (isNaN(avoidedEmissionsValue)) avoidedEmissionsValue = 0;

                  const totalEmissions = impactValue + avoidedEmissionsValue;
                  methods.push(method);
                  emissions.push(totalEmissions);
                });

                // Créer le graphique
                if (emissionsChart) {
                  emissionsChart.destroy(); // Détruire le graphique précédent s'il existe
                }

                emissionsChart = new Chart(chartCanvas, {
                  type: 'bar',
                  data: {
                    labels: methods,
                    datasets: [{
                      label: 'Émissions totales (kg éq. CO2/tonne)',
                      data: emissions,
                      backgroundColor: [
                        'rgba(255, 99, 132, 0.6)',
                        'rgba(54, 162, 235, 0.6)',
                        'rgba(75, 192, 192, 0.6)'
                      ],
                      borderColor: [
                        'rgba(255, 99, 132, 1)',
                        'rgba(54, 162, 235, 1)',
                        'rgba(75, 192, 192, 1)'
                      ],
                      borderWidth: 1
                    }]
                  },
                  options: {
                    plugins: {
                      title: {
                        display: true,
                        text: `Émissions pour ${materialData['Matériau']}`
                      },
                      tooltip: {
                        callbacks: {
                          label: function(context) {
                            const label = context.dataset.label || '';
                            const value = context.formattedValue;
                            return `${label}: ${value} kg éq. CO2/tonne`;
                          }
                        }
                      }
                    },
                    scales: {
                      y: {
                        beginAtZero: true,
                        title: {
                          display: true,
                          text: 'kg éq. CO2/tonne'
                        }
                      }
                    }
                  }
                });

              } else {
                materialInfoDiv.innerHTML = '<p>Aucune donnée disponible pour ce matériau.</p>';
                if (emissionsChart) {
                  emissionsChart.destroy();
                }
              }
            });

          })
          .catch(error => console.error('Erreur lors du chargement du fichier JSON :', error));
    });
    </script>

</body>
</html>
