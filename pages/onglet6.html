<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Version 1.9</title>
    <link href="https://fonts.googleapis.com/css2?family=Libre+Bodoni:ital,wght@1,400&family=Playfair+Display:wght@400;700&family=Montserrat:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../styles.css">
    <style>
        #material-selection {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
        }
        #material-list {
            margin-top: 20px;
        }
        .material-item {
            display: flex;
            justify-content: space-between;
            padding: 8px;
            border-bottom: 1px solid #ccc;
            align-items: center;
        }
        .material-item div {
            width: 20%;
            text-align: center;
        }
        .material-item button {
            background-color: red;
            color: white;
            border: none;
            padding: 5px;
            cursor: pointer;
            border-radius: 4px;
        }
        #version-display {
            opacity: 0;
            transition: opacity 1s ease;
        }
        .show-version {
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="header-image">
        <div class="header-overlay">Version 1.9</div>
    </div>

    <header class="menu">
        <div id="menu-container"></div>
        <script>
            fetch('../menu.html')
                .then(response => response.text())
                .then(data => {
                    document.getElementById('menu-container').innerHTML = data;
                });
        </script>
    </header>

    <main class="content">
        <h1>Sélection de Matériaux et Transport</h1>
        <div id="material-selection">
            <label for="material-dropdown">Choisissez un matériau :</label>
            <select id="material-dropdown" onchange="showCustomDensity()">
                <option value="">Sélectionnez un matériau</option>
                <!-- Options à remplir dynamiquement -->
            </select>
            <label for="custom-density">Masse volumique (kg/m³) :</label>
            <input type="number" id="custom-density" step="1" min="1">
            <label for="material-weight">Poids (kg) :</label>
            <input type="number" id="material-weight" step="1" min="1">
            <button onclick="addMaterial()">Ajouter</button>
        </div>

        <!-- Liste des matériaux ajoutés -->
        <div id="material-list">
            <div class="material-item" style="font-weight: bold;">
                <div>Matériau</div>
                <div>Masse Volumique (kg/m³)</div>
                <div>Poids (kg)</div>
                <div>Volume (m³)</div>
                <div>Action</div>
            </div>
        </div>
        <div id="vehicle-results"></div>
    </main>

    <script>
        let materialsData = {};

        async function loadMaterialsData() {
            try {
                const response = await fetch('../static/json/impactfdvmat.json');
                const data = await response.json();
                data.Feuil1.forEach(material => {
                    const name = material.Matériau;
                    const density = getEstimatedDensity(name); // Adjust this function if needed
                    materialsData[name] = density;
                });
                populateDropdown();
            } catch (error) {
                console.error("Erreur lors du chargement des données de matériaux :", error);
            }
        }

        function getEstimatedDensity(materialName) {
            // Ajoutez ici des estimations de densité en fonction du nom du matériau.
            const densities = {
                "Plastique rigide PS-PSE": 1050,
                "Plastique biosourcé PP": 960,
                "Plastique pétrosourcé PP": 960,
                "Plastique biosourcé PE": 930,
                "Plastique pétrosourcé PE": 930,
                "Acier": 8000,
                "Aluminium": 2900,
                "Verre": 2800,
                "Carton": 700,
                "Plastique rigide PVC": 1410,
                "Bois": 650, // Placeholder for any other wood material
                // Ajoutez d'autres matériaux ici
            };
            return densities[materialName] || 1000; // Valeur par défaut si non trouvé
        }

        function populateDropdown() {
            const materialDropdown = document.getElementById("material-dropdown");
            Object.keys(materialsData).forEach(material => {
                const option = document.createElement("option");
                option.value = material;
                option.textContent = material;
                materialDropdown.appendChild(option);
            });
        }

        function showCustomDensity() {
            const selectedMaterial = document.getElementById("material-dropdown").value;
            const customDensityContainer = document.getElementById("custom-density");
            if (selectedMaterial) {
                const defaultDensity = materialsData[selectedMaterial];
                customDensityContainer.value = defaultDensity;
            }
        }

        function addMaterial() {
            const selectedMaterial = document.getElementById("material-dropdown").value;
            const customDensity = document.getElementById("custom-density").value;
            const weight = document.getElementById("material-weight").value;
            const materialListDiv = document.getElementById("material-list");

            if (!selectedMaterial || !customDensity || !weight) {
                alert("Veuillez remplir tous les champs.");
                return;
            }

            const density = parseFloat(customDensity);
            const weightKg = parseFloat(weight);
            const volume = weightKg / density; // Volume en m³

            // Ajouter le matériau à la liste
            const materialItemDiv = document.createElement("div");
            materialItemDiv.classList.add("material-item");
            materialItemDiv.innerHTML = `
                <div>${selectedMaterial}</div>
                <div>${density}</div>
                <div>${weightKg}</div>
                <div>${volume.toFixed(2)}</div>
                <div><button onclick="removeMaterial(this, ${weightKg})">Supprimer</button></div>
            `;
            materialListDiv.appendChild(materialItemDiv);

            calculateVehicles(weightKg);
        }

        function removeMaterial(button, weightKg) {
            const materialItem = button.parentElement.parentElement;
            materialItem.remove();
            totalWeight -= weightKg;
            calculateVehicles(totalWeight);
        }

        function calculateVehicles(totalWeight) {
            const vehicleClasses = [
                { "class": "Véhicule utilitaire léger < 1,5 t essence", "maxLoad": 400 },
                { "class": "Véhicule utilitaire léger < 1,5 t diesel", "maxLoad": 400 },
                { "class": "Véhicule utilitaire léger 1,5 à 2,5 t essence", "maxLoad": 700 },
                { "class": "Véhicule utilitaire léger 1,5 à 2,5 t diesel", "maxLoad": 700 },
                { "class": "Camion léger 2,51 à 3,5 t essence", "maxLoad": 1200 },
                { "class": "Camion léger 2,51 à 3,5 t diesel", "maxLoad": 1200 },
                { "class": "Camion moyen 3,51 à 5 t", "maxLoad": 2370 },
                { "class": "Camion moyen 5,1 à 6 t", "maxLoad": 2840 },
                { "class": "Camion lourd 11 à 19 t", "maxLoad": 9790 }
            ];

            let vehicles = [];
            let remainingWeight = totalWeight;
            vehicleClasses.sort((a, b) => a.maxLoad - b.maxLoad);

            while (remainingWeight > 0) {
                for (let i = vehicleClasses.length - 1; i >= 0; i--) {
                    if (remainingWeight > vehicleClasses[i].maxLoad) {
                        vehicles.push(vehicleClasses[i]);
                        remainingWeight -= vehicleClasses[i].maxLoad;
                        break;
                    }
                }
                if (remainingWeight < 400) {
                    vehicles.push(vehicleClasses[0]);
                    break;
                }
            }
            document.getElementById('vehicle-results').textContent = `Véhicules proposés : ${vehicles.map(v => v.class).join(", ")}`;
        }

        window.onload = function() {
            loadMaterialsData();
        };
    </script>
</body>
</html>
