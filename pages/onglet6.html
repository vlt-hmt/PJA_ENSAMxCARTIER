<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Version 1.6</title>
    <link href="https://fonts.googleapis.com/css2?family=Libre+Bodoni:ital,wght@1,400&family=Playfair+Display:wght@400;700&family=Montserrat:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../styles.css">
    <style>
        /* Styles pour le champ personnalisé */
        #custom-density-container {
            margin-top: 15px;
            display: none; /* Caché par défaut */
        }
        #custom-density-container label {
            margin-right: 10px;
        }
        #material-list {
            margin-top: 20px;
        }
        .material-item {
            display: flex;
            justify-content: space-between;
            padding: 8px;
            border-bottom: 1px solid #ccc;
        }
        .material-item div {
            width: 20%;
            text-align: center;
        }
        #version-display {
            opacity: 0;
            transition: opacity 1s ease;
        }
        .show-version {
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="header-image">
        <div class="header-overlay">Version 1.6</div>
    </div>

    <header class="menu">
        <div id="menu-container"></div>
        <script>
            fetch('../menu.html')
                .then(response => response.text())
                .then(data => {
                    document.getElementById('menu-container').innerHTML = data;
                });
        </script>
    </header>

    <main class="content">
        <h1>Sélection de Matériaux et Transport</h1>
        <div>
            <label for="material-dropdown">Choisissez un matériau :</label>
            <select id="material-dropdown" onchange="showCustomDensity()">
                <option value="">Sélectionnez un matériau</option>
                <!-- Options à remplir dynamiquement -->
            </select>
        </div>
        <div id="custom-density-container">
            <label for="custom-density">Personnalisez la masse volumique (kg/m³) :</label>
            <input type="number" id="custom-density" step="1" min="1">
        </div>
        <div>
            <label for="material-weight">Entrez le poids (kg) :</label>
            <input type="number" id="material-weight" step="1" min="1">
        </div>
        <button onclick="addMaterial()">Ajouter le matériau</button>

        <!-- Liste des matériaux ajoutés -->
        <div id="material-list">
            <div class="material-item" style="font-weight: bold;">
                <div>Matériau</div>
                <div>Masse Volumique (kg/m³)</div>
                <div>Poids (kg)</div>
                <div>Volume (m³)</div>
            </div>
        </div>
        <div id="vehicle-results"></div>
    </main>

    <script>
        const materialsData = {
            "Plastique rigide PS-PSE": 1050,
            "Plastique biosourcé PP": 960,
            "Plastique pétrosourcé PP": 960,
            "Plastique biosourcé PE": 930,
            "Plastique pétrosourcé PE": 930,
            "Acier": 8000,
            "Aluminium": 2900,
            "Verre": 2800,
            "Carton": 700,
            "Plastique rigide PVC": 1410
        };

        function populateDropdown() {
            const materialDropdown = document.getElementById("material-dropdown");
            Object.keys(materialsData).forEach(material => {
                const option = document.createElement("option");
                option.value = material;
                option.textContent = material;
                materialDropdown.appendChild(option);
            });
        }

        function showCustomDensity() {
            const selectedMaterial = document.getElementById("material-dropdown").value;
            const customDensityContainer = document.getElementById("custom-density-container");
            if (selectedMaterial) {
                const defaultDensity = materialsData[selectedMaterial];
                document.getElementById("custom-density").value = defaultDensity;
                customDensityContainer.style.display = "block";
            } else {
                customDensityContainer.style.display = "none";
            }
        }

        function addMaterial() {
            const selectedMaterial = document.getElementById("material-dropdown").value;
            const customDensity = document.getElementById("custom-density").value;
            const weight = document.getElementById("material-weight").value;
            const materialListDiv = document.getElementById("material-list");

            if (!selectedMaterial || !customDensity || !weight) {
                alert("Veuillez remplir tous les champs.");
                return;
            }

            const density = parseFloat(customDensity);
            const weightKg = parseFloat(weight);
            const volume = weightKg / density; // Volume en m³

            // Ajouter le matériau à la liste
            const materialItemDiv = document.createElement("div");
            materialItemDiv.classList.add("material-item");
            materialItemDiv.innerHTML = `
                <div>${selectedMaterial}</div>
                <div>${density}</div>
                <div>${weightKg}</div>
                <div>${volume.toFixed(2)}</div>
            `;
            materialListDiv.appendChild(materialItemDiv);

            calculateVehicles(weightKg);
        }

        function calculateVehicles(totalWeight) {
            const vehicleClasses = [
                {
                    "class": "Véhicule utilitaire léger < 1,5 t essence",
                    "maxLoad": 400
                },
                {
                    "class": "Véhicule utilitaire léger < 1,5 t diesel",
                    "maxLoad": 400
                },
                {
                    "class": "Véhicule utilitaire léger 1,5 à 2,5 t essence",
                    "maxLoad": 700
                },
                {
                    "class": "Véhicule utilitaire léger 1,5 à 2,5 t diesel",
                    "maxLoad": 700
                },
                {
                    "class": "Camion léger 2,51 à 3,5 t essence",
                    "maxLoad": 1200
                },
                {
                    "class": "Camion léger 2,51 à 3,5 t diesel",
                    "maxLoad": 1200
                },
                {
                    "class": "Camion moyen 3,51 à 5 t",
                    "maxLoad": 2370
                },
                {
                    "class": "Camion moyen 5,1 à 6 t",
                    "maxLoad": 2840
                },
                {
                    "class": "Camion lourd 11 à 19 t",
                    "maxLoad": 9790
                }
            ];

            let vehicles = [];
            let remainingWeight = totalWeight;

            vehicleClasses.sort((a, b) => a.maxLoad - b.maxLoad);

            while (remainingWeight > 0) {
                for (let i = vehicleClasses.length - 1; i >= 0; i--) {
                    if (remainingWeight > vehicleClasses[i].maxLoad) {
                        vehicles.push(vehicleClasses[i]);
                        remainingWeight -= vehicleClasses[i].maxLoad;
                        break;
                    }
                }
                if (remainingWeight < 400) {
                    vehicles.push(vehicleClasses[0]);
                    break;
                }
            }

            document.getElementById('vehicle-results').textContent = `Véhicules proposés : ${vehicles.map(v => v.class).join(", ")}`;
        }

        // Fonction pour afficher l'animation de fondu de version
        window.onload = function() {
            const versionDisplay = document.getElementById('version-display');
            setTimeout(() => {
                versionDisplay.classList.add('show-version');
            }, 500);
        };

        populateDropdown();
    </script>
</body>
</html>
